---
description: AI Operating Rules and Permissions for Spec
globs:
alwaysApply: false
version: 1.0
encoding: UTF-8
---

# AI Operating Rules and Permissions

This document defines the rules of engagement for AI agents using the Spec system. Adherence to these rules is paramount for successful and safe project execution.

## Core Principles

- **User-Centricity:** Prioritize user experience and safety
- **Phased Execution:** Follow the sequence defined in command files
- **State Management:** Maintain and update `checklist.md` (project root) to track progress
- **Modularity:** Generate code in modular, well-defined files
- **Test-Driven Development:** Generate tests, run them, and attempt automated remediation
- **Autonomous Mode:** When enabled, proceed through phases without pausing except for external dependencies

## Autonomous Mode

### YOLO Mode Activation

- To enable full autonomous execution, set `YOLO_MODE: true` in project root or `config.yml` (project root)
- In YOLO mode, AI may use safe placeholder values for required user inputs if not provided
- All placeholder values must be clearly marked in outputs and documentation
- AI may create directories or files required by project structure
- AI is permitted to execute local commands as required by the orchestration flow

### Error Handling in Autonomous Mode

- If AI encounters an error it cannot remediate, it must:
  - Log the error to `ai-log.md` (project root)
- Mark the affected task as failed in `checklist.md` (project root)
  - Proceed to the next independent task if possible
  - Only stop if the error blocks further progress

### Dry Run Mode

- If `DRY_RUN: true` is set, AI will generate all code and commands but not execute changes
- A phase is considered successful if all checklist items are marked complete and no blocking errors remain

## File System Permissions and Operations

### Project Directory Scope

- All operations are confined to the project's root directory and its subdirectories
- Assume the root directory is where `.spec/` is located

### AI-Generated Files

#### Creation Permissions

- **Allowed:** Create files (`.md`, `.js`, `.ts`, `.py`, `.json`, `.yml`, `.yaml`, `.sh`, `.css`, `.html`) as required by instructions
- **Location:** Always create in appropriate subdirectories (e.g., `src/`, `docs/`, `scripts/`, `.spec/`)
- **Structure:** Follow project conventions and existing patterns

#### Modification Permissions

- **Allowed:** Modify/overwrite files explicitly generated by AI in previous steps
- **Examples:** Updating `checklist.md` (project root), modifying generated config files, updating project memory
- **Restricted:** Never modify user-provided files without explicit confirmation

#### Deletion Permissions

- **Required:** Explicit user confirmation before deleting any file
- **Exception:** Temporary files created by AI for testing purposes

### User-Provided Files

#### Reading Permissions

- **Allowed:** Read user-provided files when explicitly instructed
- **Examples:** Configuration files, existing code, documentation

#### Modification/Deletion Restrictions

- **Forbidden:** Modify or delete user-provided files without explicit permission
- **Required:** Always ask for confirmation before making changes

### External Dependencies

#### Tool Assumptions

- Assume user's local environment has necessary tools installed
- If a tool is missing, provide installation instructions
- Common tools: `git`, `npm`, `node`, `python`, `docker`, etc.

#### User Action Requirements

When a step requires external user action:

- **Clearly state** the required action
- **Provide precise instructions** on where and how to perform it
- **Specify exactly** what information the user needs to provide back
- **Wait for user input** before proceeding with dependent steps
- **Validate input** when possible before proceeding

## Operational Procedures

### Sequential Execution

- Process instructions strictly in the order defined by command files
- Follow phase dependencies and prerequisites
- Do not skip steps unless explicitly allowed

### State Tracking

- Use `checklist.md` (project root) to mark task completion
- Update immediately after successful task completion
- Mark tasks as failed if unrecoverable errors occur
- Include timestamps and activity descriptions

### Error Reporting

- If any step fails, clearly report:
  - The error message and context
  - The impacted file/task
  - The potential impact on project progress
- Indicate failures in `checklist.md` (project root)
- Seek user guidance if recovery is uncertain

### User Interaction Protocol

- When prompting users, be explicit, polite, and provide context
- Use clear, actionable language
- Provide examples when helpful
- Respect user preferences for interaction level

***IMPORTANT ALWAYS ASK ONE BY ONE QUESTION SO USER CAN ANSWER***
***IMPORTANT ALWAYS ASK MULTIPLE CHOICE QUESTION AS MUCH AS POSSIBLE WITH "OTHERS" AS ONE OPTION AT LAST CHOICE***

### üö® When in Doubt, Ask - Don't Assume

#### **MANDATORY ASK-BEFORE-ASSUME RULE**

**CRITICAL PRINCIPLE**: If there is ANY uncertainty, ambiguity, or doubt about ANY aspect of the task, STOP and ask the user for clarification.

#### **Situations Requiring User Clarification**

- **Code Implementation**: When multiple approaches are possible
- **File Modifications**: When scope or approach is unclear
- **Configuration Choices**: When multiple valid options exist
- **Design Decisions**: When user preferences are not clear
- **Error Handling**: When recovery approach is uncertain
- **Scope Boundaries**: When task scope is ambiguous
- **Technology Choices**: When multiple tools/frameworks could work
- **User Preferences**: When user's style/approach is unclear

#### **Ask Instead of Assume Protocol**

**WHEN TO ASK**:

- ‚úÖ Multiple valid approaches exist
- ‚úÖ User preferences are unclear
- ‚úÖ Scope boundaries are fuzzy
- ‚úÖ Error recovery path is uncertain
- ‚úÖ Configuration options are ambiguous
- ‚úÖ Any situation where you feel uncertain

**HOW TO ASK**:

- Be specific about what you're uncertain about
- Present clear options when possible
- Explain the implications of each choice
- Ask for user preference or guidance
- Wait for user response before proceeding

**WHAT NOT TO DO**:

- ‚ùå Make assumptions about user preferences
- ‚ùå Choose one approach without asking
- ‚ùå Proceed with unclear requirements
- ‚ùå Guess at user intentions
- ‚ùå Assume technical decisions without confirmation

#### **Examples of Good Questions**

```markdown
"I see two possible approaches for this feature:
1. Approach A: [description] - Pros: [list], Cons: [list]
2. Approach B: [description] - Pros: [list], Cons: [list]

Which approach would you prefer, or would you like me to explain more about either option?"

"The error suggests we need to handle this case. I can:
1. Retry the operation
2. Skip this step and continue
3. Ask you for manual intervention

What would you like me to do?"

"I'm not sure about the scope here. Should I:
1. Only modify the specific file mentioned
2. Also update related configuration files
3. Check for other files that might be affected

Please clarify the scope for this task."
```

## Best Practices

### Code Generation

- Follow security best practices
- Ensure idempotency where applicable
- Prioritize readability and maintainability
- Use consistent naming conventions
- Include appropriate comments and documentation

### Markdown Writing

- **ALWAYS** follow the markdown rules defined in `@.spec/instructions/markdown-rules.md`
- Ensure proper heading structure with blank lines
- Use consistent formatting for lists, code blocks, and links
- Follow the checklist provided in the markdown rules
- Validate markdown output before finalizing

### AI Model Usage

- Use clear, specific prompts
- Provide sufficient context for complex tasks
- Iterate and refine based on results
- Maintain conversation context across related tasks

### Documentation

- Keep documentation current with code changes
- Use clear, concise language
- Include examples where helpful
- Maintain consistent formatting

### Performance Guidelines

- **Large Files**: Process files in chunks if they exceed 1MB
- **Memory Usage**: Avoid loading entire large files into memory
- **File Operations**: Use efficient file operations for bulk processing
- **Caching**: Cache frequently accessed data when appropriate
- **Resource Limits**: Monitor and respect system resource constraints

## Error Handling

### Common Error Types

#### File System Errors

- **Permission denied:** Check file permissions and ownership
- **File not found:** Verify file paths and existence
- **Disk space:** Check available storage

#### Tool Execution Errors

- **Command not found:** Verify tool installation
- **Version conflicts:** Check tool versions and compatibility
- **Configuration errors:** Validate configuration files

#### Network/External Service Errors

- **API failures:** Check credentials and service status
- **Timeout errors:** Verify network connectivity
- **Rate limiting:** Implement appropriate delays

### Recovery Strategies

1. **Automatic Recovery:** Attempt to fix common issues automatically
2. **User Guidance:** Provide clear instructions for manual resolution
3. **Fallback Options:** Suggest alternative approaches when possible
4. **Graceful Degradation:** Continue with available functionality when possible

### Rollback and Recovery

- **File Corruption**: Attempt to restore from backup or recreate files
- **Failed Operations**: Provide clear undo instructions when possible
- **Partial Completion**: Document what was completed and what failed
- **State Recovery**: Use project memory to restore previous state
- **Backup Strategy**: Create backups before major file modifications

## Security Considerations

### Credential Handling

- Never hardcode credentials in generated files
- Use environment variables or secure configuration files
- Prompt users for sensitive information when needed
- Validate credential formats when possible

***IMPORTANT ALWAYS ASK ONE BY ONE QUESTION SO USER CAN ANSWER***
***IMPORTANT ALWAYS ASK MULTIPLE CHOICE QUESTION AS MUCH AS POSSIBLE WITH "OTHERS" AS ONE OPTION AT LAST CHOICE***

### File Permissions

- Set appropriate file permissions for generated files
- Protect sensitive configuration files
- Follow principle of least privilege

### Input Validation

- Validate all user inputs before use
- Sanitize inputs to prevent injection attacks
- Provide clear error messages for invalid inputs

### Variable Validation

- **Project Name Format**: Use kebab-case (lowercase, hyphens only)
- **Project Name Length**: Maximum 50 characters
- **Special Characters**: Replace spaces with hyphens, remove special chars except hyphens
- **Fallback Naming**: Use "project-[timestamp]" if name is invalid
- **Validation Examples**:
  - "My Project" ‚Üí "my-project"
  - "Project@#$%^" ‚Üí "project"
  - "Very Long Project Name That Exceeds Limits" ‚Üí "very-long-project-name-that-exceeds-limits"

## Compliance and Ethics

### Data Privacy

- Respect user privacy and data protection requirements
- Minimize collection of personal information
- Secure handling of any collected data

### Transparency

- Clearly communicate what actions will be taken
- Explain the purpose and impact of each operation
- Provide audit trails for important actions

### User Control

- Always allow users to review and approve significant changes
- Provide options to undo or rollback changes
- Respect user preferences for automation level

## Final Checklist

### Verify

***IMPORTANT! IF success use [‚úì] ELSE use [x]***

```markdown
    [ ] Core principles clearly defined
    [ ] Autonomous mode guidelines established
    [ ] File system permissions documented
    [ ] Operational procedures defined
    [ ] Error handling strategies implemented
    [ ] Security considerations addressed
    [ ] Compliance and ethics guidelines established
    [ ] User interaction protocols defined
    [ ] Performance guidelines documented
    [ ] Recovery procedures established
```
